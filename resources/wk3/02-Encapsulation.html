<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Encapsulation in JavaScript | Codeworks Workbook</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Resource for Codeworks Immersive FullStack Students">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.abb8cd21.css" as="style"><link rel="preload" href="/assets/js/app.8aaeaaad.js" as="script"><link rel="preload" href="/assets/js/2.41bf532a.js" as="script"><link rel="preload" href="/assets/js/25.1fef9ba0.js" as="script"><link rel="prefetch" href="/assets/js/10.c00206a1.js"><link rel="prefetch" href="/assets/js/11.f542a317.js"><link rel="prefetch" href="/assets/js/12.f9bfddc0.js"><link rel="prefetch" href="/assets/js/13.c983c316.js"><link rel="prefetch" href="/assets/js/14.beda3844.js"><link rel="prefetch" href="/assets/js/15.123056ef.js"><link rel="prefetch" href="/assets/js/16.f6c659c7.js"><link rel="prefetch" href="/assets/js/17.e2431be1.js"><link rel="prefetch" href="/assets/js/18.ab09f15e.js"><link rel="prefetch" href="/assets/js/19.19f7a85c.js"><link rel="prefetch" href="/assets/js/20.66670d21.js"><link rel="prefetch" href="/assets/js/21.41756057.js"><link rel="prefetch" href="/assets/js/22.81c53240.js"><link rel="prefetch" href="/assets/js/23.9a3a9897.js"><link rel="prefetch" href="/assets/js/24.39f3ac10.js"><link rel="prefetch" href="/assets/js/26.fa48ad4e.js"><link rel="prefetch" href="/assets/js/27.96e27fe4.js"><link rel="prefetch" href="/assets/js/28.68aed60f.js"><link rel="prefetch" href="/assets/js/29.f10a5028.js"><link rel="prefetch" href="/assets/js/3.ab8fcff8.js"><link rel="prefetch" href="/assets/js/30.d0bca2f1.js"><link rel="prefetch" href="/assets/js/31.aba092d7.js"><link rel="prefetch" href="/assets/js/4.dec6a881.js"><link rel="prefetch" href="/assets/js/5.7189ec79.js"><link rel="prefetch" href="/assets/js/6.40ece6a5.js"><link rel="prefetch" href="/assets/js/7.36978bb5.js"><link rel="prefetch" href="/assets/js/8.1831ce67.js"><link rel="prefetch" href="/assets/js/9.3908301c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abb8cd21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Codeworks Workbook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/resources/" class="nav-link router-link-active">
  Resources
</a></div><div class="nav-item"><a href="/vocab/" class="nav-link">
  Vocab
</a></div><div class="nav-item"><a href="https://boisecodeworks.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codeworks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/resources/" class="nav-link router-link-active">
  Resources
</a></div><div class="nav-item"><a href="/vocab/" class="nav-link">
  Vocab
</a></div><div class="nav-item"><a href="https://boisecodeworks.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Codeworks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Student Resources</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Building Blocks Of Web Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Intro To Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Advancing with Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/resources/wk3/01-Modules.html" class="sidebar-link">ES6 modules</a></li><li><a href="/resources/wk3/02-Encapsulation.html" aria-current="page" class="active sidebar-link">Encapsulation in JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/resources/wk3/02-Encapsulation.html#why-encapsulation" class="sidebar-link">Why Encapsulation?</a></li><li class="sidebar-sub-header"><a href="/resources/wk3/02-Encapsulation.html#idiomatic-encapsulation-in-javascript" class="sidebar-link">Idiomatic Encapsulation in JavaScript</a></li><li class="sidebar-sub-header"><a href="/resources/wk3/02-Encapsulation.html#real-encapsulation-in-javascript" class="sidebar-link">Real Encapsulation in JavaScript</a></li><li class="sidebar-sub-header"><a href="/resources/wk3/02-Encapsulation.html#using-closures" class="sidebar-link">Using Closures</a></li><li class="sidebar-sub-header"><a href="/resources/wk3/02-Encapsulation.html#using-private-fields" class="sidebar-link">Using Private Fields</a></li></ul></li><li><a href="/resources/wk3/03-Proxies.html" class="sidebar-link">An Intro to Javascript Proxy Objects</a></li><li><a href="/resources/wk3/04-ObserverPattern.html" class="sidebar-link">The Observer Pattern</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Asynchronous Code</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="encapsulation-in-javascript"><a href="#encapsulation-in-javascript" class="header-anchor">#</a> Encapsulation in JavaScript</h1> <p>Encapsulation is the bundling of data and the methods that act on that data such that access to that data is restricted from outside the bundle, or as Alan Kay describes it, &quot;local retention and protection and hiding of state-process.&quot; In OOP, that means that an object stores its state privately, and only the object's methods have access to change it.</p> <p>If you want to change encapsulated state, you don't reach out and directly mutate some object's props. Instead, you call a method on the object, and <em>maybe</em> the object will respond by updating its state. For example, if you build an application using Redux, instead of directly manipulating a view's data model, you dispatch a message called an <em>action object</em> to the data store. Redux controls the timing of when and how that message is handled. The timing and handling of that message are precisely controlled in order to create predictable, deterministic state updates. Given the same messages in the same order, Redux will always produce the same state.</p> <p>Likewise, when you want to update React component state with <code>useState</code> or <code>setState</code>, those changes don't directly manipulate the component state. Instead, they may enqueue potential state changes which get applied after the render cycle has completed. You don't directly set React's component state; React does.</p> <h2 id="why-encapsulation"><a href="#why-encapsulation" class="header-anchor">#</a> Why Encapsulation?</h2> <p>In the 1960s and 1970s, programmers were grappling with timing dependencies and resource conflicts caused by trying to share the same memory resources between different operations running in non-deterministic sequences. They were also frustrated by the need to couple code to a specific data structure representation of the program state.</p> <p>In the 1970s, Alan Kay was inspired by composite data structures from Ivan Sutherland's Sketchpad thesis, developed between 1961 and 1963 at MIT and Simula developed in the 1960s by Ole-Johan Dahl and Kristen Nygaard at the Norwegian Computing Center in Oslo. Alan Kay was involved in ARPAnet research and design, had a background in science and math, and was particularly inspired by how cells were encapsulated by a membrane and communicated via message passing.</p> <p>All those ideas came together to form the the foundations of OOP: encapsulation and message passing.</p> <p>The trouble with shared mutable state is that if your input state depends on some other instruction's output state, and any sort of concurrency arrises, it creates race conditions. If you change the order in which instructions are called, it can alter the results. Mix in any sort of non-determinism in sequencing, and the result is chaos: unpredictable, unprovable, seemingly random application state. Sometimes it works. Sometimes it doesn't.</p> <p>Encapsulation is one approach to deal with this problem.</p> <p>Encapsulation also solves another interesting problem. Imagine you have an aggregation of data you need to process. One way to do it is to first decide on a data structure to represent the data. If you start with the implementation details (let's say an array), and everything that uses it is aware of its structure, and can create tight coupling with the data structure that can make it difficult to change that implementation later. What if you eventually want to swap the array out for a stream, or a tree, or some other data structure? If everything knows the implementation, it may be too late.</p> <p>But when we encapsulate those implementation details behind a public interface, and then everything that uses the object does so only through its public interface, it's easier to change the implementation details later. To illustrate, imagine you have a data structure which stores numbers, and you need a way to multiply the stored values by two:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Only works for arrays</span>
<span class="token keyword">const</span> <span class="token function-variable function">doubleAllImperative</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> doubled <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    doubled<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> doubled<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Same as above, but works for anything with the map operation.</span>
<span class="token keyword">const</span> <span class="token function-variable function">doubleAllInterface</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">box</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">map</span><span class="token operator">:</span> <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token function">box</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">box(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> value <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token function">doubleAllInterface</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// [4, 6]</span>
  <span class="token function">doubleAllInterface</span><span class="token punctuation">(</span><span class="token function">box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// box(4)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Encapsulation can be a powerful tool capable of helping you prevent bugs resulting from shared mutable state, and also for reducing tight coupling between components and the data structures they rely on. It helps you obey at least three key principles of software design:</p> <ol><li>Avoid shared mutable state. &quot;Nondeterminism = parallel processing + mutable state&quot; --- Martin Odersky, designer of the Scala programming language</li> <li>&quot;Program to an interface, not an implementation.&quot; --- Gang of Four, <a href="https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612/ref=as_li_ss_tl?ie=UTF8&amp;linkCode=ll1&amp;tag=eejs-20&amp;linkId=7445122e05ad99f1761daaeb75239e4f&amp;language=en_US" target="_blank" rel="noopener noreferrer">&quot;Design Patterns: Elements of Reusable Object Oriented Software&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>&quot;A small change in requirements should necessitate a correspondingly small change in the software.&quot; --- N. D. Birrell, M. A. Ould, <a href="https://www.amazon.com/Practical-Handbook-Software-Development-ebook/dp/B01DM2859K/ref=as_li_ss_tl?ie=UTF8&amp;linkCode=ll1&amp;tag=eejs-20&amp;linkId=d47c3f2ec4505eb596bd974446104041&amp;language=en_US" target="_blank" rel="noopener noreferrer">&quot;A Practical Handbook for Software Development&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h2 id="idiomatic-encapsulation-in-javascript"><a href="#idiomatic-encapsulation-in-javascript" class="header-anchor">#</a> Idiomatic Encapsulation in JavaScript</h2> <p>When Brendan Eich built JavaScript in those fateful 10 days culminating in the release in 1995, he had two ideas in mind:</p> <ul><li>Scheme in the browser</li> <li>Look like Java</li></ul> <p>Scheme is a functional programming language --- a dialect of LISP, which is an elegant little language dating back to 1958. Because Scheme supports very flexible higher order functions and closures, it's capable of punching well above its weight.</p> <p>Java is a class-based object-oriented language. From Java, JavaScript got the notion of constructor functions, (eventually) classes, and the <code>new</code> keyword (among other things).</p> <p>Brendan Eich snuck in a third major inspiration from the Self programming language --- prototypes, which makes JavaScript's notion of inheritance much more powerful and flexible than its similarly named but otherwise distant cousin, Java, but that's <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-s-the-difference-between-class-prototypal-inheritance-e4cd0a7562e9" target="_blank" rel="noopener noreferrer">another story<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>23 years later, this paradigm melting pot is still a bit misunderstood. One of those common misunderstandings has to do with encapsulation.</p> <p>Before I get to idiomatic encapsulation for objects in JavaScript, I first want to address a common convention that is not a robust form of encapsulation. A long time ago, before a lot of JavaScript developers learned about <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-closure-b2f0d2152b36" target="_blank" rel="noopener noreferrer">closures<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, some JavaScript developers noticed that JavaScript objects (and later classes) did not include a mechanism for private properties.</p> <p>Prior to the <a href="https://github.com/tc39/proposal-class-fields" target="_blank" rel="noopener noreferrer">private fields proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in stage 3 of the ECMAScript Specification process as I write this, there was no way to create a private property for an object in JavaScript. Instead of falling back on closures, which already support true data privacy for objects in JavaScript, some developers decided to denote private properties and methods by prefixing them with underscores, and that has become a recognized, (though awkward and controversial) convention.</p> <p>This is problematic for multiple reasons:</p> <p>Breaking Changes: Internal properties and methods tend to change more frequently than public properties and methods. For many, underscore prefixed methods, e.g., <code>myComponent._handleClick</code> refer to methods that they do not intend users of the API to call directly. Instead, they're used only internally, and as such, if their implementations change, or if they're entirely deleted, those developers would not consider that to be a breaking change.</p> <p>Unfortunately for the users, many new developers are unaware of the underscore prefix convention, so may use the properties anyway. Experienced developers often know what it means, but figure, &quot;I know what I'm doing&quot;, and so use them anyway --- particularly if it provides an obvious solution to a current problem. In other words, a large number of people ignore the convention, and that leads to more breaking changes than necessary.</p> <p>Leaked Implementation Details: Remember the example above, where we started out supporting only arrays, but now we want to expand our support to streams? Well, if your users have direct access to the underlying data structures, they may create dependencies on those data structures, so the first time a stream is encountered, they're surprised when their code breaks.</p> <p>Expanded Attack Surface for Hackers: On public APIs in particular, adding any more surface API than is necessary to use your code expands the surface area that is available for attackers to exploit. One of the most important principles of software security to limit the attack surface only to what is absolutely necessary. If you really only intend for something to be used internally, it should not be exposed externally.</p> <p>Self Documenting Code: Your public API should be as self-documenting as possible. One way to do that is to expose only those methods and properties you intend for your users to use. That way users are not tempted to use unsupported and undocumented methods. If you use the underscore convention, you rely on the user to know what it means and to understand that you don't intend for them to use it. If you use encapsulation, you don't have to worry about that. They can't use what they don't have access to.</p> <h2 id="real-encapsulation-in-javascript"><a href="#real-encapsulation-in-javascript" class="header-anchor">#</a> Real Encapsulation in JavaScript</h2> <p>Of course, as the functional crowd knows, JavaScript has supported real data encapsulation all along. It's very easy to declare private data in JavaScript.</p> <h2 id="using-closures"><a href="#using-closures" class="header-anchor">#</a> Using Closures</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">createCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// A variable defined in a factory or constructor function scope is private to that function.</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// Any other functions defined in the same scope are privileged:</span>
    <span class="token comment">// These both have access to the private `count` variable defined anywhere in their scope chain (containing function scopes).</span>
    <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>counter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  counter<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A privileged method is a method which has access to the private data inside the containing function's scope (also known as the lexical environment). Privileged functions and methods have reference-based access to the containing function's variables even after the containing function has returned. Those references are live, so if the state changes in the containing function, in changes for every privileged function with access to the reference. In other words, when we call <code>counter.click()</code>, it changes the value that <code>counter.getCount()</code> sees.</p> <p>It's even possible to inherit private state using <a href="https://medium.com/javascript-scene/functional-mixins-composing-software-ffb66d5e731c" target="_blank" rel="noopener noreferrer">functional mixins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="using-private-fields"><a href="#using-private-fields" class="header-anchor">#</a> Using Private Fields</h2> <p>As of this writing, private fields are available in babel with the <code>stage-3</code> feature enabled. They're supported natively in Chrome, Opera, Android Browser, and Chrome for Android, so there's a good chance you can do something like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  #count <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">getCount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#count<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> myCounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCounter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCounter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCounter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  myCounter<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>I still have a strong preference for <a href="https://medium.com/javascript-scene/javascript-factory-functions-vs-constructor-functions-vs-classes-2f22ceddf33e" target="_blank" rel="noopener noreferrer">factory functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and true privacy using <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-closure-b2f0d2152b36" target="_blank" rel="noopener noreferrer">closure-based encapsulation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> over using classes and the new class fields specification, but if you actually need encapsulation, both closures and class fields are far better than underscores, because they don't rely on convention, and instead enforce true encapsulation.</p> <br> <br> <hr> <small>Elliott, Eric. “Encapsulation in JavaScript.” Medium, JavaScript Scene, 27 Aug. 2020, medium.com/javascript-scene/encapsulation-in-javascript-26be60e325b4. </small> <br></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/resources/wk3/01-Modules.html" class="prev">
        ES6 modules
      </a></span> <span class="next"><a href="/resources/wk3/03-Proxies.html">
        An Intro to Javascript Proxy Objects
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8aaeaaad.js" defer></script><script src="/assets/js/2.41bf532a.js" defer></script><script src="/assets/js/25.1fef9ba0.js" defer></script>
  </body>
</html>
